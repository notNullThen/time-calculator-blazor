@using TimeCalculator.Base
@using TimeCalculator.Base.Types

<div class="d-flex flex-column flex-md-row gap-3 align-items-start align-items-md-end">
    <div class="d-flex gap-2 align-items-end">
        <div class="d-flex flex-column">
            <label class="form-label mb-1">Hours</label>
            <input type="number" @bind="TimeCalculator.CurrentTimeEntry.Time.Hours" min="0" class="form-control"
                style="width: 100px;" />
        </div>

        <div class="d-flex flex-column">
            <label class="form-label mb-1">Minutes</label>
            <input type="number" @bind="TimeCalculator.CurrentTimeEntry.Time.Minutes" min="0" max="59"
                class="form-control" style="width: 100px;" />
        </div>

        <div class="d-flex flex-column">
            <label class="form-label mb-1">Seconds</label>
            <input type="number" @bind="TimeCalculator.CurrentTimeEntry.Time.Seconds" min="0" max="59"
                class="form-control" style="width: 100px;" />
        </div>
    </div>

    <div class="d-flex flex-column flex-grow-1 align-items-start mt-md-0">
        <label class="form-label mb-1">Type</label>
        <div class="btn-group" role="group" aria-label="Time entry type">
            <button type="button" class="@GetTypeButtonClass(TimeType.Work)"
                aria-pressed="@(IsTypeSelected(TimeType.Work))" @onclick="() => TimeCalculator.SetType(TimeType.Work)">
                Work
            </button>
            <button type="button" class="@GetTypeButtonClass(TimeType.Break)"
                aria-pressed="@(IsTypeSelected(TimeType.Break))"
                @onclick="() => TimeCalculator.SetType(TimeType.Break)">
                Break
            </button>
        </div>
    </div>
</div>

<div class="mt-3">
    <button class="btn btn-primary gap-3 mt-3" @onclick="AddTimeEntry">Add Time Entry</button>
    <button class="btn btn-outline-primary mt-3" @onclick="SetRemainedTime">Remained Time</button>
</div>

@code {
    [Parameter, EditorRequired]
    public TimeCalculatorProgramm TimeCalculator { get; set; } = default!;

    [Parameter]
    public EventCallback OnChanged { get; set; }

    private void AddTimeEntry()
    {
        TimeCalculator.AddTimeEntry();
        _ = NotifyChangedAsync();
    }

    private void SetRemainedTime()
    {
        TimeCalculator.SetRemainedTime();
        _ = NotifyChangedAsync();
    }

    private Task NotifyChangedAsync()
    {
        return OnChanged.HasDelegate ? OnChanged.InvokeAsync() : Task.CompletedTask;
    }

    public bool IsTypeSelected(TimeType type)
    {
        return TimeCalculator.CurrentTimeEntry.Type == type;
    }

    private string GetTypeButtonClass(TimeType type)
    {
        return IsTypeSelected(type) ? "btn btn-primary" : "btn btn-outline-primary";
    }
}