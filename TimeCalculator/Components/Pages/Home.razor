@page "/"
@using TimeCalculator.Base
@using TimeCalculator.Base.Types

<PageTitle>Time Calculator</PageTitle>

<div class="d-flex align-items-center justify-content-between gap-3">
    <h1 class="mb-0">Time Calculator</h1>
</div>

<div class="mt-3 mb-3">
    <div class="d-flex align-items-center gap-2">
        <div class="fw-semibold">
            Your daily work: @($"{timeCalculator.DailyWorkHours} hours")
        </div>

        @if (!_isDailyWorkTimeInputVisible)
        {
            <button class="btn @(timeCalculator.DailyWorkHours > 0 ? "btn-outline-primary" : "btn-primary")"
                @onclick="@(timeCalculator.DailyWorkHours > 0 ? EditDailyWorkTime : ShowDailyWorkTimeInput)">
                Edit
            </button>
        }
    </div>

    @if (_isDailyWorkTimeInputVisible)
    {
        <div class="d-flex gap-2 align-items-end mt-2">
            <div class="d-flex flex-column">
                <label class="form-label mb-1">Hours per day</label>
                <input type="number" @bind="timeCalculator.DailyWorkHours" min="1" class="form-control"
                    style="width: 140px;" />
            </div>

            <button class="btn btn-primary" disabled="@(timeCalculator.DailyWorkHours <= 0)"
                @onclick="SetDailyWorkTime">Set</button>
        </div>
    }
</div>

<TimeEntryForm TimeCalculator="timeCalculator" OnChanged="OnCalculatorChanged" />

<h2 class="mt-4">Time Entries</h2>

@if (timeCalculator.TimeEntries.Count == 0)
{
    <p class="text-muted mt-3 mb-0">No time entries yet.</p>
}
else
{
    <TimeEntriesTable timeCalculator="timeCalculator" OnChanged="OnCalculatorChanged" />
}

<h2>Total Work Time: @timeCalculator.TotalWorkTime.ToString()</h2>
<h4>Time left: @timeCalculator.TotalTimeLeftToWork.ToString()</h4>
<h4>Total Time: @timeCalculator.TotalTime.ToString()</h4>

@code {
    private TimeCalculatorProgramm timeCalculator = new()
    { DailyWorkHours = 8 };
    private bool _isDailyWorkTimeInputVisible;

    private void EditDailyWorkTime()
    {
        _isDailyWorkTimeInputVisible = true;
    }

    private void SetDailyWorkTime()
    {
        _isDailyWorkTimeInputVisible = false;
        timeCalculator.CalculateTotalTime();
    }

    private void ShowDailyWorkTimeInput()
    {
        _isDailyWorkTimeInputVisible = true;
    }

    private Task OnCalculatorChanged()
    {
        StateHasChanged();
        return Task.CompletedTask;
    }
}