@page "/"
@using TimeCalculator.Base
@using TimeCalculator.Base.Types

<PageTitle>Time Calculator</PageTitle>

<div class="d-flex align-items-center justify-content-between gap-3">
    <h1 class="mb-0">Time Calculator</h1>
</div>

<TimeEntryForm TimeCalculator="timeCalculator" OnChanged="OnCalculatorChanged" />

<h2 class="mt-4">Time Entries</h2>

@if (timeCalculator.TimeEntries.Count == 0)
{
    <p class="text-muted mt-3 mb-0">No time entries yet.</p>
}
else
{
    <div class="table-responsive mt-3">
        <table class="table table-striped align-middle mb-0">
            <thead>
                <tr>
                    <th scope="col">Hours</th>
                    <th scope="col">Minutes</th>
                    <th scope="col">Seconds</th>
                    <th scope="col">Formatted</th>
                    <th scope="col">Type</th>
                    <th scope="col" class="text-end">Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var entry in timeCalculator.TimeEntries)
                {
                    var isZeroTime = entry.Value.Time.IsZero;

                    <tr @key="entry" class="@(isZeroTime ? "tc-zero-time-row" : null)">
                        <td class="@(isZeroTime ? "text-muted" : null)">@entry.Value.Time.Hours</td>
                        <td class="@(isZeroTime ? "text-muted" : null)">@entry.Value.Time.Minutes</td>
                        <td class="@(isZeroTime ? "text-muted" : null)">@entry.Value.Time.Seconds</td>
                        <td class="@(isZeroTime ? "text-muted" : null)">@entry.Value.Time.ToFormattedString()</td>
                        <td class="@(isZeroTime ? "text-muted" : null)">@entry.Value.Type</td>
                        <td class="text-end">
                            <button class="btn btn-primary btn-sm"
                                @onclick="() => timeCalculator.ReplaceEntryWithCurrent(entry.Key)">Replace
                            </button>
                            <button class="btn btn-danger btn-sm"
                                @onclick="() => timeCalculator.RemoveTimeEntry(entry.Key)">Remove
                            </button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
}

<h2>Total Work Time: @timeCalculator.TotalWorkTime.ToString()</h2>
<h4>Time left: @timeCalculator.TotalTimeLeftToWork.ToString()</h4>
<h4>Total Time: @timeCalculator.TotalTime.ToString()</h4>

@code {
    private TimeCalculatorProgramm timeCalculator = new();

    private Task OnCalculatorChanged()
    {
        StateHasChanged();
        return Task.CompletedTask;
    }
}